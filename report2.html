<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>高教深耕彙整平台|報告總結管理</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="bower_components/Ionicons/css/ionicons.min.css" rel="stylesheet">
    <link href="bower_components/jvectormap/jquery-jvectormap.css" rel="stylesheet">
    <link href="dist/css/AdminLTE.min.css" rel="stylesheet">

    <link href="dist/css/skins/_all-skins.min.css" rel="stylesheet">
    <link href="bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic"
        rel="stylesheet">
    <style>
        .message {
            border-style: solid;
            border-color: gray;
            border-radius: 20px;
            width: auto;
        }

        .popup {
            border-style: solid;
            border-color: gray;
            width: auto;
        }

        .deletebutton {
            margin-left: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body class="hold-transition skin-blue sidebar-mini">

    <div class="wrapper">
        <header class="main-header">
            <a class="logo" href="index.html" style="height: 64px">
                <span class="logo-mini"><b></b></span>
                <span class="logo-lg"><b>高教深耕彙整平台</b></span></a>
            <nav class="navbar navbar-static-top">
                <a class="sidebar-toggle" data-toggle="push-menu" href="#" role="button" style="height: 64px;"><span
                        class="sr-only">Toggle navigation</span></a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <li class="dropdown user user-menu">
                            <a><span class="hidden-xs" style="font-size:20px" id="username">User Name&nbsp;</span>
                                <span class="hidden-xs" style="font-size:16px" id="usertitle">User Title&nbsp;</span>
                                <button class="btn" style="color:#707070" type="button" id="logout_btn">登出</button></a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <aside class="main-sidebar">

            <section class="sidebar">
                <ul id="menu" class="sidebar-menu" data-widget="tree">

                </ul>
            </section>
        </aside>
        <div class="content-wrapper" style="min-height: 960px;">

            <br>
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row">
                        <a style="font-size: 30px;color: #000000">報告書管理</a> <a
                            style="margin-left:20px;font-size: 24px;color:gray;">執行策略管理</a>
                    </div><br>
                    <div class="row">
                        <div class="col-sm-6">
                            <u style="font-size: 24px;color:gray;">執行策略總結</u>
                        </div>
                        <div class="col-sm-6" style="text-align:right">
                            <button class="btn-primary" type="button" id="getact_btn" data-toggle='modal'
                                data-target='#modal-table'>活動報告書列表</button>
                        </div>
                    </div>
                </div><br>
            </section>
            <section class="content">

                <div class="container-fluid">
                    <form enctype="multipart/form-data" method="post" name="fileinfo">
                        <div class="row message">
                            <div style="margin-left:10px">
                                <div class="box-body">
                                    <div class="row">
                                        <div class="col-sm-12" id="big_title1">
                                            <p style="margin-bottom:0"><span
                                                    style="color:gray;font-size:25px">教育部指標內容</span></p>
                                            <hr
                                                style="width: 100%; height: 1.5px; border: none; background-color: #8C8C8C; margin-top: 0%;">
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-3" style="text-align:left">
                                                    <span style="font-size: 18px">主軸-分項-策略代號 :</span>
                                                </div>
                                                <div class="col-sm-9">
                                                    <span id="order" style="font-size: 18px"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-3" style="text-align:left">
                                                    <span style="font-size: 18px">策略名稱 :</span>
                                                </div>
                                                <div class="col-sm-9">
                                                    <span id="strategies_name" style="font-size: 18px"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-3" style="text-align:left">
                                                    <span style="font-size: 18px">具體作法 :</span>
                                                </div>
                                                <div class="col-sm-9">
                                                    <span id="aims" style="font-size: 18px"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-3" style="text-align:left">
                                                    <span style="font-size: 18px">負責教師 :</span>
                                                </div>
                                                <div class="col-sm-9">
                                                    <span id="supervior_name" style="font-size: 18px"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <br>
                                        <!-- <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-6" style="text-align:left">
                                                    <span style="font-size: 18px">衡量基準/計算公式（量化）檢核方式（質化） :</span>
                                                </div>
                                                <div class="col-sm-6">
                                                    <span id="edu_rule" style="font-size: 18px"> </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-3" style="text-align:left">
                                                    <span style="font-size: 18px">管考欄位 :</span>
                                                </div>
                                                <div class="col-sm-9">
                                                    <span id="manage" style="font-size: 18px"></span>
                                                </div>
                                            </div>
                                        </div> -->
                                        <!-- <div class="col-sm-12" id="big_title2">
                                            <p style="margin-bottom:0"><span style="color:gray;font-size:25px">執行策略內容</span></p>
                                            <hr style="width: 100%; height: 1.5px; border: none; background-color: #8C8C8C; margin-top: 0%;">
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-3" style="text-align:left">
                                                    <span style="font-size: 18px">名稱 :</span>
                                                </div>
                                                <div class="col-sm-9">
                                                    <span id="strategies_name" style="font-size: 18px"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-3" style="text-align:left">
                                                    <span style="font-size: 18px">負責教師 :</span>
                                                </div>
                                                <div class="col-sm-9">
                                                    <span id="supervior_name" style="font-size: 18px"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid">
                                                <div class="col-sm-3" style="text-align:left">
                                                    <span style="font-size: 18px">目標 :</span>
                                                </div>
                                                <div class="col-sm-9">
                                                    <span id="strategies_aim" style="font-size: 18px"></span>
                                                </div>
                                            </div>
                                        </div> -->
                                        <div class="col-sm-12" id="big_title3">
                                            <p style="margin-bottom:0"><span
                                                    style="color:gray;font-size:25px">總結填寫</span></p>
                                            <hr
                                                style="width: 100%; height: 1.5px; border: none; background-color: #8C8C8C; margin-top: 0%;">
                                            <div class="row" id="title3">
                                                <div class="col-sm-12" style="text-align:left">
                                                    <!-- <span style="font-size: 18px">執行內容與管考指標 :</span> -->
                                                </div>
                                            </div><br>
                                        </div>
                                        <!-- <div class="col-sm-12" id="big_title4">
                                            <p style="margin-bottom:0"><span style="color:gray;font-size:25px">活動管考回答</span></p>
                                            <hr style="width: 100%; height: 1.5px; border: none; background-color: #8C8C8C; margin-top: 0%;">
                                            <div class="row" id="title4">
                                                <div class="col-sm-3" style="text-align:left">

                                                </div>
                                            </div><br>
                                        </div> -->
                                    </div><br>
                                    <div class="row">
                                        <div class="col-sm-12" style="text-align:center">
                                            <input class="btn btn-success" id="save_btn" style="width:20%" type="submit"
                                                value="儲存">

                                        </div>
                                    </div>
                                </div>
                            </div>
                    </form>
                </div>
            </section>
        </div>
    </div>
    <div class="modal fade" id="modal-table">
        <div class="modal-dialog" style="width:800px">
            <div class="modal-content">
                <div class="modal-header" style="background-color:#5991C9">
                    <button aria-label="Close" class="close" data-dismiss="modal" type="button"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" style="color:white">詳細資料</h4>
                </div>
                <div class="modal-body">
                    <div class="box-body">
                        <table class="table table-bordered table-striped" id="example2">
                            <thead>
                                <tr>
                                    <th>報告書名稱(活動或課程名稱)</th>
                                    <th>更新時間</th>
                                    <th>狀態</th>
                                    <th>是否已填寫問卷</th>
                                    <th>活動期限</th>
                                    <th>功能</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal" type="button">關閉</button>
                </div>
            </div>
        </div>
    </div>


    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="bower_components/fastclick/lib/fastclick.js"></script>

    <script src="dist/js/adminlte.min.js"></script>

    <script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

    <script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <script src="bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="dist/js/demo.js"></script>
    <script src="dist/js/cookie.js"></script>
    <script>
        $(function () {
            var opt = {
                "oLanguage": {
                    "sProcessing": "處理中...",
                    "sLengthMenu": "顯示 _MENU_ 項結果",
                    "sZeroRecords": "沒有匹配結果",
                    "sInfo": "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                    "sInfoEmpty": "顯示第 0 至 0 項結果，共 0 項",
                    "sInfoFiltered": "(從 _MAX_ 項結果過濾)",
                    "sSearch": "搜尋:",
                    "oPaginate": {
                        "sFirst": "首頁",
                        "sPrevious": "上一頁",
                        "sNext": "下一頁",
                        "sLast": "尾頁"
                    }
                }
            };
            $('#example1').DataTable(opt)

            $('#example2').DataTable({
                'paging': true,
                'lengthChange': true,
                'searching': false,
                'ordering': false,
                'info': true,
                'autoWidth': false,
                'oLanguage': {
                    "sProcessing": "處理中...",
                    "sLengthMenu": "顯示 _MENU_ 項結果",
                    "sZeroRecords": "沒有匹配結果",
                    "sInfo": "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                    "sInfoEmpty": "顯示第 0 至 0 項結果，共 0 項",
                    "sInfoFiltered": "(從 _MAX_ 項結果過濾)",
                    "sSearch": "搜尋:",
                    "oPaginate": {
                        "sFirst": "首頁",
                        "sPrevious": "上一頁",
                        "sNext": "下一頁",
                        "sLast": "尾頁"
                    }
                }
            })


        })

        function detail_fun(pid) {
            var token = GetCookie("token");
            SetCookie("pid", pid, 1, domain);
            document.location.href = 'result3.html';
        }
        $(document).ready(function () {

            var table = $('#example2').DataTable();
            var user_name = GetCookie("user_name");
            $("#username").text(user_name);
            var usertitle = GetCookie("role_name");
            $('#usertitle').text(usertitle);
            var token = GetCookie("token");
            var sno_option_strategies = GetCookie("sno_option_strategies");

            $.ajax({
                type: "POST",
                url: "phpMod/menu.php",
                async: false, ///非同步執行
                dataType: "json",
                data: {
                    token: token,
                    page: 3,
                    subpage: 1
                },
                success: function (data) {
                    if (checkMsg(data.msg)) {
                        var menu = data.remenu;
                        $("#menu").append(menu);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            })

            $.ajax({
                type: "POST",
                url: "phpMod/summary_get_content.php",
                async: false, ///非同步執行
                dataType: "json",
                data: {
                    token: token,
                    sno_option_strategies: sno_option_strategies
                },
                success: function (data) {

                    if (checkMsg(data.msg)) {
                        console.log(data);
                        var strategies_detail = data.out.strategies_detail[0];
                        //console.log(strategies_detail["aims"]);
                        $("#order").text(strategies_detail["order"]);
                        $("#aims").text(strategies_detail["aims"]);
                        $("#strategies_name").text(strategies_detail["strategies_name"]);
                        $("#supervior_name").text(strategies_detail["supervior_name"]); 
                        var edu_qlength = data.out.management_detail.length;
                        for (var i = edu_qlength - 1; i >= 0; --i) {
                            $("#title3").after('<div class="row "><div class="col-sm-3" style="text-align:left">' +
                                '<span style="font-size: 20px;font-weight: bold">管考指標： </span></div><div class="col-sm-9"><span style="font-size: 20px;font-weight: bold">' + 
                                data.out.management_detail[i]['indicator_name']+"/"+data.out.management_detail[i]['sub_name']+"/"+data.out.management_detail[i]['detail_name']+
                                '<\/span><\/div></div>' +
                                '<div class="row edu_title_'+i+'"><div class="col-sm-3" style="text-align:left">' +
                                '<span style="font-size: 20px;font-weight: bold">衡量基準： </span></div><div class="col-sm-9"><span style="font-size: 20px;font-weight: bold">' + data.out.management_detail[i]['edu_name'] +
                                '<\/span><\/div></div></br>'
                            );
                            
                            var act_qlength = data.out.management_detail[i].answer.length;
                            var act_question = data.out.management_detail[i].answer;
                            console.log(act_qlength);
                            console.log(act_question);
                            //$(".edu_title").after('<br><div class="row"><div class="col-sm-3"> <span style="font-size: 20px;font-weight: bold">活動回答</span></div><div class="col-sm-9"></div></div>');
                            for (var j = act_qlength - 1; j >= 0; --j) {
                                if (act_question[j]['type'] == 0) {
                                    $(".edu_title_"+i).after('<br><div class="row"><div class="col-sm-3"> <span style="font-size: 20px;font-weight: bold">活動回答</span></div><div class="col-sm-9"></div></div>'+
                                        '<div class="row" style="margin-left:5%"><div class="col-sm-3" style="text-align:left">' +
                                        '<span style="font-size: 18px">活動名稱： </span></div><div class="col-sm-9"><span>' + act_question[j]['name'] +
                                        '<\/span><\/div></div>' +
                                        '<div class="row" style="margin-left:5%"><div class="col-sm-3" style="text-align:left">' +
                                        '<span style="font-size: 18px">管考題目： </span></div><div class="col-sm-9"><span>' + act_question[j]['question'] +
                                        '<\/span><\/div></div>' +
                                        '<div class="row" style="margin-left:5%"><div class="col-sm-3" style="text-align:left">' +
                                        '<span style="font-size: 18px">執行成效： </span></div><div class="col-sm-9"><span>' + act_question[j]['results'] +
                                        '<\/span><\/div></div><br>'
                                    );
                                }
                                else {
                                    $(".edu_title_"+i).after('<br><div class="row"><div class="col-sm-3"> <span style="font-size: 20px;font-weight: bold">活動回答</span></div><div class="col-sm-9"></div></div>'+
                                        '<div class="row" style="margin-left:5%"><div class="col-sm-3" style="text-align:left">' +
                                        '<span style="font-size: 18px">活動名稱： </span></div><div class="col-sm-9"><span>' + act_question[j]['name'] +
                                        '<\/span><\/div></div>' +
                                        '<div class="row" style="margin-left:5%"><div class="col-sm-3" style="text-align:left">' +
                                        '<span style="font-size: 18px">管考題目： </span></div><div class="col-sm-9"><span>' + act_question[j]['question'] +
                                        '<\/span><\/div></div>' +
                                        '<div class="row" style="margin-left:5%"><div class="col-sm-3" style="text-align:left">' +
                                        '<span style="font-size: 18px">執行成效： </span></div><div class="col-sm-9"><a href="' + act_question[j]['results'] + '">' + act_question[j]['results'] +
                                        '<\/a<\/div></div><br>'
                                    );
                                }

                            }
                            

                        }

                    }

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });
            $("#save_btn").click(function () {
                var token = GetCookie("token");
                var result = [];
                var sno_option_strategies_summary = [];
                $('textarea').each(function (index) {
                    result[index] = $(this).val();
                    sno_option_strategies_summary[index] = $(this).attr('id');

                });

                var results = JSON.stringify({
                    sno_option_strategies_summary: sno_option_strategies_summary,
                    result: result
                });

                var test = JSON.parse(results);

                var form = document.forms.namedItem("fileinfo");

                form.addEventListener('submit', function (ev) {
                    oData = new FormData(form);
                    oData.append("token", token);
                    oData.append("results", results);

                    var oReq = new XMLHttpRequest();
                    oReq.open("POST", "phpMod/summary_update.php", true);
                    oReq.onload = function (oEvent) {
                        if (oReq.status == 200) {
                            alert("更新成功");
                            document.location.href = 'report.html';
                        } else {

                        }
                    };

                    oReq.send(oData);

                    ev.preventDefault();
                }, false);
            });
            $("#getact_btn").on("click", function () {
                table.clear();
                var sno_option_strategies = GetCookie("sno_option_strategies");
                
                $.ajax({
                    type: "POST",
                    url: "phpMod/summary_get_report.php",
                    async: false, ///非同步執行
                    dataType: "json",
                    data: {
                        token: token,
                        sno_option_strategies: sno_option_strategies
                    },
                    success: function (data) {
                        if (!checkMsg(data.msg)) {
                            delete_all_cookie();
                        }
                        if (checkMsg(data.msg)) {
                            console.log(data.out);
                            for (var i = 0; i < data.out.length; i++) {
                                var data_array = data.out;
                                var pid = data_array[i]['p_id'];
                                var project_name = data_array[i]['p_name'];
                                var update_time = data_array[i]['update'];
                                var estimated_date = data_array[i]['limted_date'];
                                var is_filled_result = data_array[i]['isfilled'];
                                var review_state = data_array[i]['type'];

                                table.row.add([
                                    project_name,
                                    update_time,
                                    review_state,
                                    is_filled_result,
                                    estimated_date,
                                    "<button type='button' class='btn bg-olive btn-sm' onClick=detail_fun(this.id) id=" + pid + " value='" + pid + "'>詳細資料</button>"
                                ]).draw(false);

                            }

                        }

                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                    }
                });
            })

            $("#logout_btn").click(function () {
                $.ajax({
                    type: "POST",
                    url: "phpMod/signout_serve.php",
                    async: false, ///非同步執行
                    dataType: "json",
                    data: {
                        token: token
                    },
                    success: function (data) {
                        if (checkMsg(data.msg)) {

                            delete_all_cookie();
                        }

                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                    }
                })
            })


        });
    </script>

</body>

</html>