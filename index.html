<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <title>高教深耕彙整平台|首頁</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="bower_components/Ionicons/css/ionicons.min.css" rel="stylesheet" />
    <link href="bower_components/jvectormap/jquery-jvectormap.css" rel="stylesheet" />
    <link href="dist/css/AdminLTE.min.css" rel="stylesheet" />
    <link href="dist/css/skins/_all-skins.min.css" rel="stylesheet" />
    <link href="bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic"
        rel="stylesheet" />
    <style>
        .message {
            border-style: solid;
            border-color: gray;
            margin-left: 20px;
            width: auto;
        }

        .popup {
            border-style: solid;
            border-color: gray;
            width: auto;
        }
    </style>
</head>

<body class="hold-transition skin-blue sidebar-mini">
    <form>

        <div class="wrapper ">
            <header class="main-header">
                <a class="logo" href="index.html" style="height: 64px"><span class="logo-mini"><b></b></span> <span
                        class="logo-lg"><b>高教深耕彙整平台</b></span></a>
                <nav class="navbar navbar-static-top">
                    <a class="sidebar-toggle" data-toggle="push-menu" href="#" role="button" style="height: 64px;"><span
                            class="sr-only">Toggle navigation</span></a>
                    <div class="navbar-custom-menu">
                        <ul class="nav navbar-nav">
                            <li class="dropdown user user-menu">
                                <a><span class="hidden-xs" id="username" style="font-size:20px">User Name&nbsp;</span>
                                    <span class="hidden-xs" id="usertitle" style="font-size:16px">User
                                        Title&nbsp;</span>
                                    <button class="btn" id="logout_btn" style="color:#707070" type="button">
                                        登出
                                    </button></a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>
            <aside class="main-sidebar">
                <section class="sidebar">
                    <ul class="sidebar-menu" data-widget="tree" id="menu"></ul>
                </section>
            </aside>
            <div class="content-wrapper" style="min-height: 960px;">
                <br />
                <section class="content-header">
                    <div class="container-fluid">
                        <h1 style="font-size: 30px">首頁</h1>
                        <a style="font-size: 24px;color:gray;">年度(民國) :</a>
                        <select id="year"> </select>
                        <a style="font-size: 24px;color:gray;">註：預設為今年，年度列表為資料庫裡有資料之年度</a>

                        <br />
                    </div>
                </section>
                <section class="content">
                    <div class="container-fluid">
                        <div class="row " style="border-style:solid;border-color:gray">
                            <div style="margin-left:10px">
                                <h1 style="font-size: 20px">站內訊息</h1>
                                <br />
                                <div class="box-body">
                                    <table class="table table-bordered table-striped" id="example1">
                                        <thead>
                                            <tr>
                                                <th>送件者</th>
                                                <th>送件時間</th>
                                                <th>主軸-分項-策略</th>
                                                <th>計劃名稱</th>
                                                <th>最新狀態</th>
                                                <th>功能</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div><br />
                        <div class="row" style="border-style:solid;border-color:gray">
                            <div style="margin-left:10px">
                                <h1 style="font-size: 20px">成果報告列表</h1>
                                <br />
                                <div class="box-body">
                                    <table class="table table-bordered table-striped" id="example3"
                                        style="border:1px #000000 solid;">
                                        <thead>
                                            <tr>
                                                <th style="display: none">ID</th>
                                                <th>主軸-分項-策略</th>
                                                <th>報告書名稱(活動或課程名稱)</th>
                                                <th>更新時間</th>
                                                <th>活動期限</th>
                                                <th>是否已填寫問卷</th>
                                                <th>狀態</th>
                                                <th>功能</th>
                                                <th>診斷小組審查</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
            <div class="modal fade" id="modal-default">
                <div class="modal-dialog" style="width:800px">
                    <div class="modal-content">
                        <div class="modal-header" style="background-color:#5991C9">
                            <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title" style="color:white">審核紀錄</h4>
                        </div>
                        <div class="modal-body">
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-sm-3">
                                        <span style="font-size: 20px;">活動報告書名稱 : <span></span></span>
                                    </div>
                                    <div class="col-sm-9">
                                        <span style="font-size: 20px;" id="pro_name"></span>
                                    </div>
                                </div><br />
                                <div class="row">
                                    <div class="col-sm-3">
                                        <button type="button" class="btn btn-lg btn-primary" id="enter_project_btn">進入活動報告書</button>
                                    </div>

                                </div>
                                <br />
                                <table class="table table-bordered table-striped" id="example2">
                                    <thead>
                                        <tr>
                                            <th>送件時間</th>
                                            <th>送件者</th>
                                            <th>收件者</th>
                                            <th>額外訊息</th>
                                            <th>狀態</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <span style="font-size: 30px;"><button class="btn btn-default" data-dismiss="modal"
                                    type="button">
                                    <span style="font-size: 30px;">關閉</span>
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="modal-review">
                <div class="modal-dialog" style="width:1000px">
                    <div class="container-fluid">
                        <div class="modal-content">
                            <div class="modal-header" style="background-color:#5991C9">
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" style="color:white">診斷小組審查紀錄</h4>
                            </div>

                            <div class="modal-body">
                                <div class="box-body">
                                    <div class="container-fluid">
                                        <div id="reply_msg">
                                            <div class="row" style="border-style:solid;border-color:#707070">
                                                <div class="col-sm-3" style="padding-top:1%"><span
                                                        style="font-size:20px">回覆
                                                        : </span></div>
                                                <div class="col-sm-6" style="padding-top:1%"><textarea rows="5"
                                                        cols="50" id="review_msg"></textarea></div>
                                                <div class="col-sm-3" style="padding-top:8%"><button type="button"
                                                        class="btn btn-primary btn-sm" id="send_review_msg">送出</button>
                                                </div>
                                            </div>
                                        </div>
                                        <br>

                                        <div class="row review_table" style="border-style:solid;border-color:#707070;">
                                            <div
                                                style="margin-left: 2%;margin-right: 2%;margin-top: 2%;margin-bottom: 2%">
                                                <table class="table table-bordered table-striped" id="example4">
                                                    <thead>
                                                        <tr>
                                                            <th style="display: none">ID</th>
                                                            <th>送件時間</th>
                                                            <th>送件者</th>
                                                            <th>審查人員</th>
                                                            <th>審查狀態</th>
                                                            <th>額外訊息</th>
                                                            <th>功能</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" type="button">
                                    儲存
                                </button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="bower_components/fastclick/lib/fastclick.js"></script>
    <script src="dist/js/adminlte.min.js"></script>
    <script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <script src="bower_components/chart.js/Chart.js"></script>
    <script src="bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="dist/js/demo.js"></script>
    <script src="dist/js/cookie.js"></script>
    <script>
        function detail_fun2(pid) {
            var token = GetCookie("token");
            SetCookie("pid", pid, 1, domain);
            document.location.href = "result3.html";
        }
        function detail_fun(pid) {
            var token = GetCookie("token");
            SetCookie("pid", pid, 1, domain);
            var table2 = $("#example2").DataTable();
            table2.clear();

            $.ajax({
                type: "POST",
                url: "phpMod/letter_get_list.php",
                async: false,
                dataType: "json",
                data: {
                    token: token,
                    sno_option_projects: pid
                },
                success: function (data) {
                    if (!checkMsg(data.msg)) {
                        //alert(data.msg);
                        delete_all_cookie();
                    }
                    if (checkMsg(data.msg)) {
                        //alert(data.msg);
                        var project_name = data.out[0]["projects_name"];

                        $("#pro_name").text(project_name);
                        
                        for (var i = 0; i < data.out.length; i++) {
                            var data_array = data.out;
                            var created_at = data_array[i]["created_at"];
                            var source = data_array[i]["source"];
                            var exmsg = data_array[i]["exmsg"];
                            var type = data_array[i]["type"];
                            var target = data_array[i]["target"];

                            table2.row.add([created_at, source, target, exmsg, type]).draw(false);
                        }
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    //alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });
        }
        $("#example4").DataTable({
            paging: true,
            lengthChange: true,
            searching: true,
            ordering: true,
            info: true,
            autoWidth: false,
            columnDefs: [
                {
                    targets: [0],
                    visible: false
                }
            ],
            order: [[1, "desc"]],
            oLanguage: {
                sProcessing: "處理中...",
                sLengthMenu: "顯示 _MENU_ 項結果",
                sZeroRecords: "沒有匹配結果",
                sInfo: "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                sInfoEmpty: "顯示第 0 至 0 項結果，共 0 項",
                sInfoFiltered: "(從 _MAX_ 項結果過濾)",
                sSearch: "搜尋:",
                oPaginate: {
                    sFirst: "首頁",
                    sPrevious: "上一頁",
                    sNext: "下一頁",
                    sLast: "尾頁"
                }
            }
        });
        function get_review_list(pid) {
            $("#reply_msg").hide();
            var token = GetCookie("token");
            var review_table = $("#example4").DataTable();
            review_table.clear().draw();
            $.ajax({
                type: "POST",
                url: "phpMod/paper_review_get_list.php",
                async: false, ///非同步執行
                dataType: "json",
                data: {
                    token: token,
                    sno_option_projects: pid
                },
                success: function (data) {
                    if (checkMsg(data.msg)) {
                        for (var i = 0; i < data.out.length; i++) {
                            var data_array = data.out[i];
                            review_table.row
                                .add([
                                    data_array["sno_reviewed"],
                                    data_array["updated_at"],
                                    data_array["review_name"],
                                    data_array["send_name"],
                                    data_array["need_reply"],
                                    data_array["message"],
                                    '<button type="button" class="btn btn-primary btn-sm " id="btn_reply" >回覆</button>'
                                ])
                                .draw();
                        }
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });
        }
        $(function () {
            $("#example2").DataTable({
                paging: true,
                lengthChange: true,
                searching: false,
                ordering: false,
                info: true,
                autoWidth: false,
                oLanguage: {
                    sProcessing: "處理中...",
                    sLengthMenu: "顯示 _MENU_ 項結果",
                    sZeroRecords: "沒有匹配結果",
                    sInfo: "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                    sInfoEmpty: "顯示第 0 至 0 項結果，共 0 項",
                    sInfoFiltered: "(從 _MAX_ 項結果過濾)",
                    sSearch: "搜尋:",
                    oPaginate: {
                        sFirst: "首頁",
                        sPrevious: "上一頁",
                        sNext: "下一頁",
                        sLast: "尾頁"
                    }
                }
            });
            $("#example3").DataTable({
                paging: true,
                lengthChange: true,
                searching: true,
                ordering: true,
                info: true,
                autoWidth: false,
                columnDefs: [
                    {
                        targets: [0],
                        visible: false
                    }
                ],
                order: [[1, "desc"]],
                oLanguage: {
                    sProcessing: "處理中...",
                    sLengthMenu: "顯示 _MENU_ 項結果",
                    sZeroRecords: "沒有匹配結果",
                    sInfo: "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                    sInfoEmpty: "顯示第 0 至 0 項結果，共 0 項",
                    sInfoFiltered: "(從 _MAX_ 項結果過濾)",
                    sSearch: "搜尋:",
                    oPaginate: {
                        sFirst: "首頁",
                        sPrevious: "上一頁",
                        sNext: "下一頁",
                        sLast: "尾頁"
                    }
                }
            });


            var opt = {
                oLanguage: {
                    sProcessing: "處理中...",
                    sLengthMenu: "顯示 _MENU_ 項結果",
                    sZeroRecords: "沒有匹配結果",
                    sInfo: "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                    sInfoEmpty: "顯示第 0 至 0 項結果，共 0 項",
                    sInfoFiltered: "(從 _MAX_ 項結果過濾)",
                    sSearch: "搜尋:",
                    oPaginate: {
                        sFirst: "首頁",
                        sPrevious: "上一頁",
                        sNext: "下一頁",
                        sLast: "尾頁"
                    }
                }
            };
            // var y = new Date();
            // var year_now = y.getFullYear() - 1911;
            // console.log(year_now);
            var table = $("#example1").DataTable(opt);
            var token = GetCookie("token");
            var user_name = GetCookie("user_name");
            var role_name = GetCookie("role_name");
            //checkToken();

            $("#username").text(user_name);
            $("#usertitle").text(role_name);

            $.ajax({
                type: "POST",
                url: "phpMod/letter_get_list1.php",
                async: false,
                dataType: "json",
                data: {
                    token: token
                },
                success: function (data) {
                    if (!checkMsg(data.msg)) {
                        delete_all_cookie();
                    } else {
                        console.log("letter:", data.out);
                        table.clear();
                        for (var i = 0; i < data.out.length; i++) {

                            var data_array = data.out;
                            var created_at = data_array[i]["created_at"];
                            var sno_option_projects = data_array[i]["sno_option_projects"];
                            var sno_source = data_array[i]["sno_source"];
                            var name = data_array[i]["name"];
                            var type = data_array[i]["type"];
                            var project_name = data_array[i]["project_name"];
                            var project_order = data_array[i]["order"];
                            console.log("order", project_order);
                            table.row
                                .add([
                                    name,
                                    created_at,
                                    project_order,
                                    project_name,
                                    type,
                                    "<button type='button' class='btn bg-olive btn-sm' onClick=detail_fun(this.id) id = " +
                                    sno_option_projects +
                                    " value = '" +
                                    sno_option_projects +
                                    "' data-toggle='modal' data-target='#modal-default'> 詳細資料<\/button >"
                                ])
                                .draw(false);
                        }
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    //alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });
            $.ajax({
                type: "POST",
                url: "phpMod/select_project_yyy.php",
                async: false, ///非同步執行
                dataType: "json",
                data: {
                    token: token
                },
                success: function (data) {
                    if (checkMsg(data.msg)) {
                        var years = data.out;
                        for (var i = 0; i < years.length; i++) {
                            var o = new Option(years[i], years[i]);
                            $("#year").append(o);
                        }
                        $("#year").val(years[0]);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });
            var year = $("#year").val();
            var t = $("#example3").DataTable();
            $.ajax({
                type: "POST",
                url: "phpMod/find_project_serve.php",
                async: false, ///非同步執行
                dataType: "json",
                data: {
                    token: token,
                    year: year
                },
                success: function (data) {
                    if (!checkMsg(data.msg)) {
                        DelCookie("token", domain);
                        document.location.href = "login.html";
                    }
                    if (checkMsg(data.msg)) {
                        for (var i = 0; i < data.outt.length; i++) {
                            var data_array = JSON.parse(data.outt[i]);
                            //console.log(data_array);
                            var pid = data_array["pid"];
                            var project_name = data_array["project_name"];
                            var update_time = data_array["update_time"];
                            var estimated_date = data_array["estimated_date"];
                            var is_filled_result = data_array["is_filled_result"];
                            var review_state = data_array["review_state"];
                            var order = data_array["order"];
                            if (is_filled_result == 0) {
                                t.row
                                    .add([
                                        pid,
                                        order,
                                        project_name,
                                        update_time,
                                        estimated_date,
                                        "未填寫問卷",
                                        review_state,

                                        "<button type='button' class='btn bg-olive btn-sm' onClick=detail_fun2(this.id) id=" +
                                        pid +
                                        " value='" +
                                        pid +
                                        "'>詳細資料<\/button>",
                                        "<button type='button' class='btn btn-primary btn-sm' id='review' data-toggle='modal' data-target='#modal-review' >審查紀錄<\/button>"
                                    ])
                                    .draw(false);

                            } else {
                                t.row
                                    .add([
                                        pid,
                                        order,
                                        project_name,
                                        update_time,
                                        estimated_date,
                                        "已填寫問卷",
                                        review_state,

                                        "<button type='button' class='btn bg-olive btn-sm' onClick=detail_fun2(this.id) id=" +
                                        pid +
                                        " value='" +
                                        pid +
                                        "'>詳細資料<\/button>",
                                        "<button type='button' class='btn btn-primary btn-sm' id='review' data-toggle='modal' data-target='#modal-review' >審查紀錄<\/button>"
                                    ])
                                    .draw(false);
                            }

                        }
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });

            $("#year").on("change", function () {
                if ($("#q_ver").val() == "a") {
                    $("#save_btn").hide();
                } else $("#save_btn").show();
                t.clear();
                year = $("#year").val();
                console.log(year);
                $.ajax({
                    type: "POST",
                    url: "phpMod/find_project_serve.php",
                    async: false, ///非同步執行
                    dataType: "json",
                    data: {
                        token: token,
                        year: year
                    },
                    success: function (data) {
                        if (!checkMsg(data.msg)) {
                            DelCookie("token", domain);
                            document.location.href = "login.html";
                        }
                        if (checkMsg(data.msg)) {
                            for (var i = 0; i < data.outt.length; i++) {
                                var data_array = JSON.parse(data.outt[i]);
                                //console.log(data_array);
                                var pid = data_array["pid"];
                                var project_name = data_array["project_name"];
                                var update_time = data_array["update_time"];
                                var estimated_date = data_array["estimated_date"];
                                var is_filled_result = data_array["is_filled_result"];
                                var review_state = data_array["review_state"];
                                var order = data_array["order"];
                                if (is_filled_result == 0) {
                                    t.row
                                        .add([
                                            pid,
                                            order,
                                            project_name,
                                            update_time,
                                            estimated_date,
                                            "未填寫問卷",
                                            review_state,
                                            "<button type='button' class='btn bg-olive btn-sm' onClick=detail_fun2(this.id) id=" +
                                            pid +
                                            " value='" +
                                            pid +
                                            "'>詳細資料<\/button>",
                                            "<button type='button' class='btn btn-primary btn-sm' id='review' data-toggle='modal' data-target='#modal-review' >審查紀錄<\/button>"
                                        ])
                                        .draw(false);

                                } else {
                                    t.row
                                        .add([
                                            pid,
                                            order,
                                            project_name,
                                            update_time,
                                            estimated_date,
                                            "已填寫問卷",
                                            review_state,
                                            "<button type='button' class='btn bg-olive btn-sm' onClick=detail_fun2(this.id) id=" +
                                            pid +
                                            " value='" +
                                            pid +
                                            "'>詳細資料<\/button>",
                                            "<button type='button' class='btn btn-primary btn-sm' id='review' data-toggle='modal' data-target='#modal-review' >審查紀錄<\/button>"
                                        ])
                                        .draw(false);
                                }

                            }
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                    }
                });
            });


            $("#logout_btn").click(function () {
                $.ajax({
                    type: "POST",
                    url: "phpMod/signout_serve.php",
                    async: false,
                    dataType: "json",
                    data: {
                        token: token
                    },
                    success: function (data) {

                        if (!(checkMsg(data.msg))) {

                            delete_all_cookie();
                        } else {
                            delete_all_cookie();
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        // alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                    }
                });
            });
            $("#enter_project_btn").click(function(){
                document.location.href = "result3.html";
            })

            $.ajax({
                type: "POST",
                url: "phpMod/menu.php",
                async: false,
                dataType: "json",
                data: {
                    token: token,
                    page: 1,
                    subpage: 0
                },
                success: function (data) {
                    if (checkMsg(data.msg)) {
                        var menu = data.remenu;
                        $("#menu").append(menu);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    //alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });
        });
        $("#example3 tbody").on("click", "button#review", function () {
            var t = $("#example3").DataTable();
            $("#reply_msg").hide();
            var token = GetCookie("token");
            var data = t.row($(this).parents("tr")).data();
            var pid = data[0];
            SetCookie("pid", pid, 1, domain);
            console.log(data);
            var review_table = $("#example4").DataTable();
            review_table.clear().draw();
            $.ajax({
                type: "POST",
                url: "phpMod/paper_review_get_list.php",
                async: false, ///非同步執行
                dataType: "json",
                data: {
                    token: token,
                    sno_option_projects: pid
                },
                success: function (data) {

                    if (checkMsg(data.msg)) {
                        console.log("review:", data.out);

                        for (var i = 0; i < data.out.length; i++) {
                            var data_array = data.out[i];
                            if (data_array["need_reply"] == "已審查待回復") {
                                review_table.row
                                    .add([
                                        data_array["sno_reviewed"],
                                        data_array["updated_at"],
                                        data_array["review_name"],
                                        data_array["send_name"],
                                        data_array["need_reply"],
                                        data_array["message"],
                                        '<button type="button" class="btn btn-primary btn-sm " id="btn_reply" >回覆</button>'
                                    ])
                                    .draw();
                            }
                            else {
                                review_table.row
                                    .add([
                                        data_array["sno_reviewed"],
                                        data_array["updated_at"],
                                        data_array["review_name"],
                                        data_array["send_name"],
                                        data_array["need_reply"],
                                        data_array["message"],
                                        ''
                                    ])
                                    .draw();
                            }

                        }
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });

        });

        $("#example4 tbody").on("click", "button#btn_reply", function () {
            var review_table = $("#example4").DataTable();
            var data = review_table.row($(this).parents("tr")).data();
            var review_id = data[0];
            //console.log(data);
            SetCookie("review_id", data[0], 1, domain);
            $("#reply_msg").show();
            $("#review_msg").val("");
        });

        $("#send_review_msg").on("click", function () {
            var review_id = GetCookie("review_id");
            var pid = GetCookie("pid");
            console.log(review_id);
            var token = GetCookie("token");
            var message = $("#review_msg").val();
            console.log(message);
            $.ajax({
                type: "POST",
                url: "phpMod/paper_review_reply.php",
                async: false, ///非同步執行
                dataType: "json",
                data: {
                    token: token,
                    sno_reviewed: review_id,
                    message: message
                },
                success: function (data) {
                    if (checkMsg(data.msg)) {
                        console.log(data.msg);
                        get_review_list(pid);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.readyState + XMLHttpRequest.status + XMLHttpRequest.responseText);
                }
            });
        });


    </script>
</body>

</html>